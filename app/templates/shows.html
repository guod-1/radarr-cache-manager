{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-wrap justify-between items-center mb-4 gap-4">
        <h1 class="text-3xl font-bold text-white">TV Shows <span id="visibleCount" class="text-lg font-normal text-gray-400">({{ total }})</span></h1>
        <input type="text" id="showSearch" oninput="applyFilters()"
               placeholder="Search shows..."
               class="bg-gray-900 border border-gray-700 text-gray-300 text-sm rounded-lg px-4 py-2 w-72 focus:ring-1 focus:ring-teal-500 outline-none">
    </div>

    <!-- Tag filters -->
    {% if all_tags %}
    <div class="flex items-center gap-3 mb-6">
        <label class="text-xs font-bold text-gray-500 uppercase tracking-widest shrink-0">Filter by Tag</label>
        <select id="tagFilter" onchange="setTagFilter(this.value)"
                class="bg-gray-900 border border-gray-700 text-gray-300 text-sm rounded-lg px-3 py-2 outline-none focus:ring-1 focus:ring-teal-500 cursor-pointer">
            <option value="">All</option>
            <option value="__untagged__">No Tags</option>
            {% for tag in all_tags %}
            <option value="{{ tag }}">{{ tag }}</option>
            {% endfor %}
        </select>
    </div>
    {% endif %}

    <div class="bg-gray-800 shadow rounded-lg overflow-hidden">
        <table id="showsTable" class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gray-900">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Seasons</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tags</th>
                </tr>
            </thead>
            <tbody class="bg-gray-800 divide-y divide-gray-700">
                {% for show in shows %}
                <tr data-title="{{ show.title | lower }}" data-tags="{{ show.tags | join(',') | lower }}">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">{{ show.title }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">{{ show.year }}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">{{ show.seasons }}</td>
                    <td class="px-6 py-4 text-sm text-gray-400">
                        <div class="flex flex-wrap gap-1">
                            {% for tag in show.tags %}
                            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-teal-900 text-teal-200">{{ tag }}</span>
                            {% endfor %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if not shows %}
        <div class="text-center py-12"><p class="text-gray-500">No TV shows found</p></div>
        {% endif %}
    </div>
</div>

<script>
let activeTag = null;

function setTagFilter(val) {
    activeTag = val || null;
    applyFilters();
}

function applyFilters() {
    const search = document.getElementById('showSearch').value.toLowerCase();
    const rows = document.querySelectorAll('#showsTable tbody tr');
    let visible = 0;
    rows.forEach(row => {
        const title = row.dataset.title || '';
        const tags = row.dataset.tags || '';
        const matchesSearch = !search || title.includes(search);
        let matchesTag = true;
        if (activeTag === '__untagged__') matchesTag = tags === '';
        else if (activeTag) matchesTag = tags.split(',').includes(activeTag.toLowerCase());
        row.style.display = matchesSearch && matchesTag ? '' : 'none';
        if (matchesSearch && matchesTag) visible++;
    });
    document.getElementById('visibleCount').textContent = `(${visible})`;
}
</script>
{% endblock %}
